// Application Data - Ledo Sports Academy
let appData = {
  heroSlides: [
    {
      id: 1,
      title: "Welcome to Ledo Sports Academy",
      subtitle: "Excellence in Sports Training",
      description: "Discover your potential with our world-class training programs and experienced coaches. Join us in building champions of tomorrow.",
      backgroundImage: "https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=1200&h=700&fit=crop",
      ctaText: "Join Our Academy",
      ctaLink: "#members"
    },
    {
      id: 2,
      title: "Championship Winning Team",
      subtitle: "Regional Champions 2024",
      description: "Our dedication to excellence has earned us the regional championship title. Be part of our winning legacy.",
      backgroundImage: "https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?w=1200&h=700&fit=crop",
      ctaText: "View Achievements",
      ctaLink: "#experiences"
    },
    {
      id: 3,
      title: "State-of-the-Art Facilities",
      subtitle: "Modern Training Complex",
      description: "Train in our newly renovated facilities equipped with the latest technology and equipment for optimal performance.",
      backgroundImage: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=1200&h=700&fit=crop",
      ctaText: "Explore Facilities",
      ctaLink: "#activities"
    },
    {
      id: 4,
      title: "Community Sports Festival",
      subtitle: "Annual Championship Event",
      description: "Join hundreds of participants in our annual community sports festival. Register now for upcoming tournaments.",
      backgroundImage: "https://images.unsplash.com/photo-1555717588-d53f4e5ea81c?w=1200&h=700&fit=crop",
      ctaText: "Register Now",
      ctaLink: "#activities"
    }
  ],
  activities: [
    {
      id: 1,
      title: "Championship League Match vs Eagles FC",
      date: "2025-08-12",
      time: "16:00",
      description: "Ledo Sports Academy vs Eagles FC - Championship League Quarter Final match at home ground.",
      image: "https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=400&h=300&fit=crop",
      status: "upcoming"
    },
    {
      id: 2,
      title: "Annual Sports Day Celebration",
      date: "2025-08-18",
      time: "09:00",
      description: "Join us for our annual sports day with competitions, awards ceremony, and community celebration.",
      image: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&h=300&fit=crop",
      status: "upcoming"
    },
    {
      id: 3,
      title: "Weekly Training Session",
      date: "2025-08-06",
      time: "17:30",
      description: "Regular training session for all academy members at the main practice field.",
      image: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=300&fit=crop",
      status: "upcoming"
    },
    {
      id: 4,
      title: "Junior Academy Trials",
      date: "2025-08-22",
      time: "14:00",
      description: "Open trials for junior academy program. Ages 8-16 welcome to showcase their talent.",
      image: "https://images.unsplash.com/photo-1577223625816-7546f13df25d?w=400&h=300&fit=crop",
      status: "upcoming"
    },
    {
      id: 5,
      title: "Inter-Academy Tournament",
      date: "2025-08-25",
      time: "10:00",
      description: "Regional tournament featuring top sports academies. Multiple matches throughout the day.",
      image: "https://images.unsplash.com/photo-1526232761682-d26e85d9d5c8?w=400&h=300&fit=crop",
      status: "upcoming"
    },
    {
      id: 6,
      title: "Summer Camp Training Concluded",
      date: "2025-07-30",
      time: "18:00",
      description: "Successfully completed our intensive summer training camp with 50+ participants.",
      image: "https://images.unsplash.com/photo-1551698618-1dfe5d97d256?w=400&h=300&fit=crop",
      status: "recent"
    },
    {
      id: 7,
      title: "Regional Championship Victory",
      date: "2025-07-25",
      time: "15:30",
      description: "Our team secured victory in the regional championship finals against City Sports Club.",
      image: "https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?w=400&h=300&fit=crop",
      status: "recent"
    },
    {
      id: 8,
      title: "Community Coaching Workshop",
      date: "2025-07-20",
      time: "10:00",
      description: "Conducted free coaching workshop for local community coaches and young enthusiasts.",
      image: "https://images.unsplash.com/photo-1526232761682-d26e85d9d5c8?w=400&h=300&fit=crop",
      status: "recent"
    }
  ],
  members: [
    {
      id: 1,
      name: "Arjun Sharma",
      contact: "arjun@email.com",
      phone: "+91-9876-543210",
      joinDate: "2023-01-15",
      role: "Team Captain",
      image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face"
    },
    {
      id: 2,
      name: "Priya Patel",
      contact: "priya@email.com",
      phone: "+91-9876-543211",
      joinDate: "2023-02-20",
      role: "Vice Captain",
      image: "https://images.unsplash.com/photo-1494790108755-2616b332b6d9?w=150&h=150&fit=crop&crop=face"
    },
    {
      id: 3,
      name: "Rohit Kumar",
      contact: "rohit@email.com",
      phone: "+91-9876-543212",
      joinDate: "2023-03-10",
      role: "Senior Player",
      image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face"
    },
    {
      id: 4,
      name: "Anita Singh",
      contact: "anita@email.com",
      phone: "+91-9876-543213",
      joinDate: "2023-04-05",
      role: "Goalkeeper Coach",
      image: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop&crop=face"
    },
    {
      id: 5,
      name: "Vikram Gupta",
      contact: "vikram@email.com",
      phone: "+91-9876-543214",
      joinDate: "2023-05-12",
      role: "Defense Specialist",
      image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=150&fit=crop&crop=face"
    },
    {
      id: 6,
      name: "Deepika Rao",
      contact: "deepika@email.com",
      phone: "+91-9876-543215",
      joinDate: "2023-06-18",
      role: "Forward",
      image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=150&h=150&fit=crop&crop=face"
    },
    {
      id: 7,
      name: "Rahul Verma",
      contact: "rahul@email.com",
      phone: "+91-9876-543216",
      joinDate: "2023-07-22",
      role: "Midfielder",
      image: "https://images.unsplash.com/photo-1463453091185-61582044d556?w=150&h=150&fit=crop&crop=face"
    },
    {
      id: 8,
      name: "Sneha Joshi",
      contact: "sneha@email.com",
      phone: "+91-9876-543217",
      joinDate: "2023-08-15",
      role: "Junior Trainer",
      image: "https://images.unsplash.com/photo-1554151228-14d9def656e4?w=150&h=150&fit=crop&crop=face"
    }
  ],
  donations: [
    {
      id: 1,
      donorName: "Ledo Foundation Trust",
      amount: 50000,
      date: "2025-07-10",
      purpose: "Infrastructure Development"
    },
    {
      id: 2,
      donorName: "Local Sports Committee",
      amount: 25000,
      date: "2025-07-15",
      purpose: "Equipment Purchase"
    },
    {
      id: 3,
      donorName: "Arjun Sharma",
      amount: 5000,
      date: "2025-07-20",
      purpose: "Youth Development Program"
    },
    {
      id: 4,
      donorName: "City Business Association",
      amount: 15000,
      date: "2025-07-25",
      purpose: "Tournament Participation"
    },
    {
      id: 5,
      donorName: "Anonymous Supporter",
      amount: 8000,
      date: "2025-08-01",
      purpose: "General Academy Operations"
    },
    {
      id: 6,
      donorName: "Parents Association",
      amount: 12000,
      date: "2025-08-02",
      purpose: "New Uniforms and Kit"
    }
  ],
  experiences: [
    {
      id: 1,
      title: "Regional Championship Victory 2024",
      date: "2024-12-20",
      description: "Ledo Sports Academy clinched the regional championship title after defeating three top academies. Our players showcased exceptional skill and teamwork throughout the tournament.",
      image: "https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?w=400&h=300&fit=crop"
    },
    {
      id: 2,
      title: "New Training Complex Inauguration",
      date: "2024-10-15",
      description: "Official opening of our state-of-the-art training complex with modern facilities, synthetic turf, and advanced training equipment. A milestone achievement for Ledo Sports Academy.",
      image: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=300&fit=crop"
    },
    {
      id: 3,
      title: "Community Sports Festival Success",
      date: "2024-08-18",
      description: "Organized and hosted the annual community sports festival with over 500 participants from 15 local schools. The event promoted sports culture and healthy competition.",
      image: "https://images.unsplash.com/photo-1577223625816-7546f13df25d?w=400&h=300&fit=crop"
    },
    {
      id: 4,
      title: "Academy's 5th Anniversary Celebration",
      date: "2024-06-10",
      description: "Celebrated Ledo Sports Academy's 5th anniversary with a grand ceremony attended by over 400 members, alumni, and supporters. Honored our achievements and future vision.",
      image: "https://images.unsplash.com/photo-1555717588-d53f4e5ea81c?w=400&h=300&fit=crop"
    },
    {
      id: 5,
      title: "First National Tournament Participation",
      date: "2024-04-25",
      description: "Ledo Sports Academy made its debut in the national tournament, reaching the semi-finals. A proud moment that marked our entry into elite-level competition.",
      image: "https://images.unsplash.com/photo-1526232761682-d26e85d9d5c8?w=400&h=300&fit=crop"
    }
  ],
  expenses: [
    {
      id: 1,
      description: "Training Equipment Purchase",
      amount: 15000,
      date: "2025-07-05",
      category: "Equipment",
      vendor: "Sports Pro Equipment Ltd",
      paymentMethod: "Bank Transfer"
    },
    {
      id: 2,
      description: "Monthly Ground Maintenance",
      amount: 8000,
      date: "2025-07-01",
      category: "Maintenance",
      vendor: "Green Fields Services",
      paymentMethod: "Cash"
    },
    {
      id: 3,
      description: "Coach Transportation Allowance",
      amount: 3500,
      date: "2025-07-10",
      category: "Transportation",
      vendor: "Coaching Staff",
      paymentMethod: "UPI"
    },
    {
      id: 4,
      description: "Utility Bills - Electricity",
      amount: 4200,
      date: "2025-07-15",
      category: "Utilities",
      vendor: "State Electricity Board",
      paymentMethod: "Online"
    },
    {
      id: 5,
      description: "Medical Kit and First Aid Supplies",
      amount: 2800,
      date: "2025-07-18",
      category: "Medical",
      vendor: "MedCare Supplies",
      paymentMethod: "Card"
    },
    {
      id: 6,
      description: "Tournament Registration Fees",
      amount: 12000,
      date: "2025-07-22",
      category: "Tournament",
      vendor: "Regional Sports Federation",
      paymentMethod: "Bank Transfer"
    },
    {
      id: 7,
      description: "Marketing and Publicity Materials",
      amount: 5500,
      date: "2025-07-25",
      category: "Marketing",
      vendor: "Creative Print Solutions",
      paymentMethod: "Cash"
    },
    {
      id: 8,
      description: "Insurance Premium",
      amount: 18000,
      date: "2025-07-28",
      category: "Insurance",
      vendor: "National Insurance Co",
      paymentMethod: "Bank Transfer"
    },
    {
      id: 9,
      description: "Refreshments for Training Sessions",
      amount: 3200,
      date: "2025-08-01",
      category: "Food & Beverage",
      vendor: "Local Caterers",
      paymentMethod: "UPI"
    },
    {
      id: 10,
      description: "Office Supplies and Stationery",
      amount: 1800,
      date: "2025-08-02",
      category: "Office",
      vendor: "Office Mart",
      paymentMethod: "Card"
    }
  ],
  weeklyFees: [
    {
      memberId: 1,
      memberName: "Arjun Sharma",
      payments: [
        {"date": "2025-07-06", "amount": 20, "status": "paid"},
        {"date": "2025-07-13", "amount": 20, "status": "paid"},
        {"date": "2025-07-20", "amount": 20, "status": "paid"},
        {"date": "2025-07-27", "amount": 20, "status": "paid"},
        {"date": "2025-08-03", "amount": 20, "status": "pending"}
      ]
    },
    {
      memberId: 2,
      memberName: "Priya Patel",
      payments: [
        {"date": "2025-07-06", "amount": 20, "status": "paid"},
        {"date": "2025-07-13", "amount": 20, "status": "paid"},
        {"date": "2025-07-20", "amount": 20, "status": "overdue"},
        {"date": "2025-07-27", "amount": 20, "status": "paid"},
        {"date": "2025-08-03", "amount": 20, "status": "pending"}
      ]
    },
    {
      memberId: 3,
      memberName: "Rohit Kumar",
      payments: [
        {"date": "2025-07-06", "amount": 20, "status": "paid"},
        {"date": "2025-07-13", "amount": 20, "status": "paid"},
        {"date": "2025-07-20", "amount": 20, "status": "paid"},
        {"date": "2025-07-27", "amount": 20, "status": "paid"},
        {"date": "2025-08-03", "amount": 20, "status": "paid"}
      ]
    },
    {
      memberId: 4,
      memberName: "Anita Singh",
      payments: [
        {"date": "2025-07-06", "amount": 20, "status": "paid"},
        {"date": "2025-07-13", "amount": 20, "status": "overdue"},
        {"date": "2025-07-20", "amount": 20, "status": "paid"},
        {"date": "2025-07-27", "amount": 20, "status": "paid"},
        {"date": "2025-08-03", "amount": 20, "status": "pending"}
      ]
    },
    {
      memberId: 5,
      memberName: "Vikram Gupta",
      payments: [
        {"date": "2025-07-06", "amount": 20, "status": "paid"},
        {"date": "2025-07-13", "amount": 20, "status": "paid"},
        {"date": "2025-07-20", "amount": 20, "status": "paid"},
        {"date": "2025-07-27", "amount": 20, "status": "overdue"},
        {"date": "2025-08-03", "amount": 20, "status": "pending"}
      ]
    },
    {
      memberId: 6,
      memberName: "Deepika Rao",
      payments: [
        {"date": "2025-07-06", "amount": 20, "status": "paid"},
        {"date": "2025-07-13", "amount": 20, "status": "paid"},
        {"date": "2025-07-20", "amount": 20, "status": "paid"},
        {"date": "2025-07-27", "amount": 20, "status": "paid"},
        {"date": "2025-08-03", "amount": 20, "status": "paid"}
      ]
    },
    {
      memberId: 7,
      memberName: "Rahul Verma",
      payments: [
        {"date": "2025-07-06", "amount": 20, "status": "paid"},
        {"date": "2025-07-13", "amount": 20, "status": "paid"},
        {"date": "2025-07-20", "amount": 20, "status": "paid"},
        {"date": "2025-07-27", "amount": 20, "status": "paid"},
        {"date": "2025-08-03", "amount": 20, "status": "pending"}
      ]
    },
    {
      memberId: 8,
      memberName: "Sneha Joshi",
      payments: [
        {"date": "2025-07-06", "amount": 20, "status": "paid"},
        {"date": "2025-07-13", "amount": 20, "status": "paid"},
        {"date": "2025-07-20", "amount": 20, "status": "paid"},
        {"date": "2025-07-27", "amount": 20, "status": "paid"},
        {"date": "2025-08-03", "amount": 20, "status": "paid"}
      ]
    }
  ]
};

// Application state
let isAdminMode = false;
let currentEditingItem = null;
let currentEditingType = null;
let financialChart = null;
let expenseChart = null;
let slideshowInterval = null;
let currentSlideIndex = 0;
let isCurrentlyOnHome = true;
let isSlideshowPaused = false;

// Initialize app when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, initializing app...');
  initializeApp();
  setupEventListeners();
  setupKeyboardShortcuts();
});

function initializeApp() {
  console.log('Initializing app...');
  
  // Render all content
  renderHeroSlideshow();
  renderHomeEvents();
  renderDashboard();
  renderActivities();
  renderMembers();
  renderDonations();
  renderExpenses();
  renderExperiences();
  renderWeeklyFees();
  updateTotalDonations();
  updateTotalExpenses();
  renderRecentActivities();
  
  // Show home section by default
  showSection('home');
  startSlideshow();
  
  console.log('App initialized successfully');
}

function setupEventListeners() {
  console.log('Setting up event listeners...');
  
  // Navigation - using event delegation for better reliability
  document.addEventListener('click', function(e) {
    if (e.target.matches('.nav-link')) {
      e.preventDefault();
      const href = e.target.getAttribute('href');
      if (href && href.startsWith('#')) {
        const target = href.substring(1);
        console.log('Navigating to section:', target);
        showSection(target);
        setActiveNavLink(e.target);
        
        // Update slideshow state based on current section
        isCurrentlyOnHome = (target === 'home');
        if (isCurrentlyOnHome && !isSlideshowPaused) {
          startSlideshow();
        } else {
          stopSlideshow();
        }
        
        // Close mobile menu if open
        const nav = document.getElementById('nav');
        if (nav) nav.classList.remove('active');
      }
    }
  });

  // Mobile menu toggle
  const mobileMenuToggle = document.getElementById('mobileMenuToggle');
  if (mobileMenuToggle) {
    mobileMenuToggle.addEventListener('click', function() {
      const nav = document.getElementById('nav');
      if (nav) nav.classList.toggle('active');
    });
  }

  // Admin login/logout - with error handling
  setupAdminEventListeners();

  // Member search
  const memberSearch = document.getElementById('memberSearch');
  if (memberSearch) {
    memberSearch.addEventListener('input', function(e) {
      filterMembers(e.target.value);
    });
  }

  // PDF Export buttons
  setupPDFExportListeners();

  // Modal event listeners
  setupModalEventListeners();

  // Slideshow pause on hover
  setupSlideshowHoverListeners();
  
  console.log('Event listeners set up successfully');
}

function setupKeyboardShortcuts() {
  document.addEventListener('keydown', function(e) {
    // Check for Ctrl+Shift+A
    if (e.ctrlKey && e.shiftKey && e.code === 'KeyA') {
      e.preventDefault();
      const adminLoginModal = document.getElementById('adminLoginModal');
      if (adminLoginModal && !isAdminMode) {
        adminLoginModal.classList.remove('hidden');
        const passwordInput = document.getElementById('adminPassword');
        if (passwordInput) {
          passwordInput.focus();
        }
      }
    }
  });
}

function setupSlideshowHoverListeners() {
  const slideshowContainer = document.querySelector('.hero-slideshow');
  if (slideshowContainer) {
    slideshowContainer.addEventListener('mouseenter', function() {
      if (isCurrentlyOnHome) {
        isSlideshowPaused = true;
        stopSlideshow();
      }
    });
    
    slideshowContainer.addEventListener('mouseleave', function() {
      if (isCurrentlyOnHome) {
        isSlideshowPaused = false;
        startSlideshow();
      }
    });
  }
}

// Slideshow Functions
function renderHeroSlideshow() {
  const slidesWrapper = document.getElementById('slidesWrapper');
  const indicatorsContainer = document.getElementById('slideshowIndicators');
  
  if (!slidesWrapper || !indicatorsContainer) return;
  
  slidesWrapper.innerHTML = '';
  indicatorsContainer.innerHTML = '';
  
  appData.heroSlides.forEach(function(slide, index) {
    // Create slide
    const slideElement = document.createElement('div');
    slideElement.className = index === 0 ? 'slide active' : 'slide';
    slideElement.style.backgroundImage = 'url("' + slide.backgroundImage + '")';
    
    slideElement.innerHTML = 
      '<div class="slide-overlay">' +
        '<div class="slide-content">' +
          '<h1 class="slide-title">' + slide.title + '</h1>' +
          '<h2 class="slide-subtitle">' + slide.subtitle + '</h2>' +
          '<p class="slide-description">' + slide.description + '</p>' +
          '<a href="' + slide.ctaLink + '" class="slide-cta" onclick="handleSlideNavigation(\'' + slide.ctaLink + '\')">' + slide.ctaText + '</a>' +
        '</div>' +
      '</div>';
    
    slidesWrapper.appendChild(slideElement);
    
    // Create indicator
    const indicator = document.createElement('div');
    indicator.className = index === 0 ? 'indicator active' : 'indicator';
    indicator.addEventListener('click', function() {
      goToSlide(index);
    });
    
    indicatorsContainer.appendChild(indicator);
  });
}

function handleSlideNavigation(link) {
  if (link.startsWith('#')) {
    const target = link.substring(1);
    showSection(target);
    setActiveNavLink(document.querySelector('[href="' + link + '"]'));
    isCurrentlyOnHome = false;
    isSlideshowPaused = false;
    stopSlideshow();
  }
}

function startSlideshow() {
  if (slideshowInterval) clearInterval(slideshowInterval);
  
  // Only start if we're on home and not paused
  if (isCurrentlyOnHome && !isSlideshowPaused) {
    slideshowInterval = setInterval(function() {
      nextSlide();
    }, 3000); // 3 seconds
  }
}

function stopSlideshow() {
  if (slideshowInterval) {
    clearInterval(slideshowInterval);
    slideshowInterval = null;
  }
}

function nextSlide() {
  currentSlideIndex = (currentSlideIndex + 1) % appData.heroSlides.length;
  goToSlide(currentSlideIndex);
}

function goToSlide(index) {
  const slides = document.querySelectorAll('.slide');
  const indicators = document.querySelectorAll('.indicator');
  
  // Remove active class from all slides and indicators
  slides.forEach(function(slide) {
    slide.classList.remove('active');
  });
  indicators.forEach(function(indicator) {
    indicator.classList.remove('active');
  });
  
  // Add active class to current slide and indicator
  if (slides[index]) slides[index].classList.add('active');
  if (indicators[index]) indicators[index].classList.add('active');
  
  currentSlideIndex = index;
}

// Home Events Functions
function renderHomeEvents() {
  renderRecentEvents();
  renderUpcomingEvents();
}

function renderRecentEvents() {
  const grid = document.getElementById('recentEventsGrid');
  if (!grid) return;
  
  grid.innerHTML = '';
  
  const recentEvents = appData.activities
    .filter(function(activity) { return activity.status === 'recent'; })
    .slice(0, 3);
  
  recentEvents.forEach(function(event) {
    const eventCard = createEventCard(event);
    grid.appendChild(eventCard);
  });
}

function renderUpcomingEvents() {
  const grid = document.getElementById('upcomingEventsGrid');
  if (!grid) return;
  
  grid.innerHTML = '';
  
  const upcomingEvents = appData.activities
    .filter(function(activity) { return activity.status === 'upcoming'; })
    .sort(function(a, b) { return new Date(a.date) - new Date(b.date); })
    .slice(0, 5);
  
  upcomingEvents.forEach(function(event) {
    const eventCard = createEventCard(event);
    grid.appendChild(eventCard);
  });
}

function createEventCard(event) {
  const card = document.createElement('div');
  card.className = 'event-card';
  
  const formattedDate = new Date(event.date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  card.innerHTML = 
    '<img src="' + event.image + '" alt="' + event.title + '" class="event-image" onerror="this.style.display=\'none\'">' +
    '<h4 class="event-title">' + event.title + '</h4>' +
    '<div class="event-meta">' +
      '<span>📅 ' + formattedDate + '</span>' +
      '<span>🕐 ' + event.time + '</span>' +
    '</div>' +
    '<p class="event-description">' + event.description + '</p>';

  return card;
}

function setupAdminEventListeners() {
  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const adminLogoutBtn = document.getElementById('adminLogoutBtn');
  const adminLoginModal = document.getElementById('adminLoginModal');
  const cancelLoginBtn = document.getElementById('cancelLoginBtn');
  const adminLoginForm = document.getElementById('adminLoginForm');

  console.log('Admin elements:', {
    loginBtn: !!adminLoginBtn,
    logoutBtn: !!adminLogoutBtn,
    modal: !!adminLoginModal,
    form: !!adminLoginForm
  });

  if (adminLogoutBtn) {
    adminLogoutBtn.addEventListener('click', function() {
      console.log('Admin logout button clicked');
      logout();
    });
  }

  if (cancelLoginBtn) {
    cancelLoginBtn.addEventListener('click', function() {
      if (adminLoginModal) {
        adminLoginModal.classList.add('hidden');
      }
      const passwordInput = document.getElementById('adminPassword');
      if (passwordInput) passwordInput.value = '';
    });
  }

  if (adminLoginForm) {
    adminLoginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      console.log('Admin login form submitted');
      const passwordInput = document.getElementById('adminPassword');
      if (passwordInput) {
        const password = passwordInput.value;
        console.log('Password entered:', password ? 'YES' : 'NO');
        if (password === 'admin123') {
          console.log('Login successful');
          login();
          if (adminLoginModal) adminLoginModal.classList.add('hidden');
          passwordInput.value = '';
        } else {
          console.log('Login failed');
          showMessage('Invalid password. Please try again.', 'error');
          passwordInput.value = '';
        }
      }
    });
  }
}

function setupPDFExportListeners() {
  const exportAllDataBtn = document.getElementById('exportAllDataBtn');
  const exportFinancialBtn = document.getElementById('exportFinancialBtn');
  const exportMembersBtn = document.getElementById('exportMembersBtn');
  const exportExpensesBtn = document.getElementById('exportExpensesBtn');

  if (exportAllDataBtn) {
    exportAllDataBtn.addEventListener('click', function() {
      console.log('Export all data clicked');
      exportToPDF('all');
    });
  }
  if (exportFinancialBtn) {
    exportFinancialBtn.addEventListener('click', function() {
      console.log('Export financial clicked');
      exportToPDF('financial');
    });
  }
  if (exportMembersBtn) {
    exportMembersBtn.addEventListener('click', function() {
      console.log('Export members clicked');
      exportToPDF('members');
    });
  }
  if (exportExpensesBtn) {
    exportExpensesBtn.addEventListener('click', function() {
      console.log('Export expenses clicked');
      exportToPDF('expenses');
    });
  }
}

function setupModalEventListeners() {
  // Activity modal
  const addActivityBtn = document.getElementById('addActivityBtn');
  const activityModal = document.getElementById('activityModal');
  const cancelActivityBtn = document.getElementById('cancelActivityBtn');
  const activityForm = document.getElementById('activityForm');

  if (addActivityBtn) {
    addActivityBtn.addEventListener('click', function() {
      currentEditingItem = null;
      currentEditingType = 'activity';
      const modalTitle = document.getElementById('activityModalTitle');
      if (modalTitle) modalTitle.textContent = 'Add Activity';
      if (activityForm) activityForm.reset();
      if (activityModal) activityModal.classList.remove('hidden');
    });
  }

  if (cancelActivityBtn) {
    cancelActivityBtn.addEventListener('click', function() {
      if (activityModal) activityModal.classList.add('hidden');
    });
  }

  if (activityForm) {
    activityForm.addEventListener('submit', function(e) {
      e.preventDefault();
      saveActivity();
      if (activityModal) activityModal.classList.add('hidden');
    });
  }

  // Member modal
  const addMemberBtn = document.getElementById('addMemberBtn');
  const memberModal = document.getElementById('memberModal');
  const cancelMemberBtn = document.getElementById('cancelMemberBtn');
  const memberForm = document.getElementById('memberForm');

  if (addMemberBtn) {
    addMemberBtn.addEventListener('click', function() {
      currentEditingItem = null;
      currentEditingType = 'member';
      const modalTitle = document.getElementById('memberModalTitle');
      if (modalTitle) modalTitle.textContent = 'Add Member';
      if (memberForm) memberForm.reset();
      if (memberModal) memberModal.classList.remove('hidden');
    });
  }

  if (cancelMemberBtn) {
    cancelMemberBtn.addEventListener('click', function() {
      if (memberModal) memberModal.classList.add('hidden');
    });
  }

  if (memberForm) {
    memberForm.addEventListener('submit', function(e) {
      e.preventDefault();
      saveMember();
      if (memberModal) memberModal.classList.add('hidden');
    });
  }

  // Donation modal
  const addDonationBtn = document.getElementById('addDonationBtn');
  const donationModal = document.getElementById('donationModal');
  const cancelDonationBtn = document.getElementById('cancelDonationBtn');
  const donationForm = document.getElementById('donationForm');

  if (addDonationBtn) {
    addDonationBtn.addEventListener('click', function() {
      currentEditingItem = null;
      currentEditingType = 'donation';
      const modalTitle = document.getElementById('donationModalTitle');
      if (modalTitle) modalTitle.textContent = 'Add Donation';
      if (donationForm) donationForm.reset();
      if (donationModal) donationModal.classList.remove('hidden');
    });
  }

  if (cancelDonationBtn) {
    cancelDonationBtn.addEventListener('click', function() {
      if (donationModal) donationModal.classList.add('hidden');
    });
  }

  if (donationForm) {
    donationForm.addEventListener('submit', function(e) {
      e.preventDefault();
      saveDonation();
      if (donationModal) donationModal.classList.add('hidden');
    });
  }

  // Expense modal
  const addExpenseBtn = document.getElementById('addExpenseBtn');
  const expenseModal = document.getElementById('expenseModal');
  const cancelExpenseBtn = document.getElementById('cancelExpenseBtn');
  const expenseForm = document.getElementById('expenseForm');

  if (addExpenseBtn) {
    addExpenseBtn.addEventListener('click', function() {
      currentEditingItem = null;
      currentEditingType = 'expense';
      const modalTitle = document.getElementById('expenseModalTitle');
      if (modalTitle) modalTitle.textContent = 'Add Expense';
      if (expenseForm) expenseForm.reset();
      if (expenseModal) expenseModal.classList.remove('hidden');
    });
  }

  if (cancelExpenseBtn) {
    cancelExpenseBtn.addEventListener('click', function() {
      if (expenseModal) expenseModal.classList.add('hidden');
    });
  }

  if (expenseForm) {
    expenseForm.addEventListener('submit', function(e) {
      e.preventDefault();
      saveExpense();
      if (expenseModal) expenseModal.classList.add('hidden');
    });
  }

  // Experience modal
  const addExperienceBtn = document.getElementById('addExperienceBtn');
  const experienceModal = document.getElementById('experienceModal');
  const cancelExperienceBtn = document.getElementById('cancelExperienceBtn');
  const experienceForm = document.getElementById('experienceForm');

  if (addExperienceBtn) {
    addExperienceBtn.addEventListener('click', function() {
      currentEditingItem = null;
      currentEditingType = 'experience';
      const modalTitle = document.getElementById('experienceModalTitle');
      if (modalTitle) modalTitle.textContent = 'Add Experience';
      if (experienceForm) experienceForm.reset();
      if (experienceModal) experienceModal.classList.remove('hidden');
    });
  }

  if (cancelExperienceBtn) {
    cancelExperienceBtn.addEventListener('click', function() {
      if (experienceModal) experienceModal.classList.add('hidden');
    });
  }

  if (experienceForm) {
    experienceForm.addEventListener('submit', function(e) {
      e.preventDefault();
      saveExperience();
      if (experienceModal) experienceModal.classList.add('hidden');
    });
  }

  // Close modals when clicking outside
  document.querySelectorAll('.modal').forEach(function(modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.classList.add('hidden');
      }
    });
  });
}

function showSection(sectionId) {
  console.log('Showing section:', sectionId);
  
  // Hide all sections
  const sections = document.querySelectorAll('.section');
  sections.forEach(function(section) {
    section.classList.remove('active');
  });
  
  // Show target section
  const targetSection = document.getElementById(sectionId);
  if (targetSection) {
    targetSection.classList.add('active');
    console.log('Section shown successfully:', sectionId);
    
    // Render charts when dashboard is shown
    if (sectionId === 'dashboard') {
      setTimeout(function() {
        renderCharts();
      }, 100);
    }
  } else {
    console.error('Section not found:', sectionId);
  }
}

function setActiveNavLink(activeLink) {
  const navLinks = document.querySelectorAll('.nav-link');
  navLinks.forEach(function(link) {
    link.classList.remove('active');
  });
  if (activeLink) {
    activeLink.classList.add('active');
  }
}

function login() {
  console.log('Logging in as admin...');
  isAdminMode = true;
  document.body.classList.add('admin-mode');
  
  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const adminLogoutBtn = document.getElementById('adminLogoutBtn');
  
  if (adminLoginBtn) adminLoginBtn.classList.remove('hidden');
  if (adminLogoutBtn) adminLogoutBtn.classList.remove('hidden');
  
  showMessage('Successfully logged in as admin');
  console.log('Admin mode activated');
}

function logout() {
  console.log('Logging out...');
  isAdminMode = false;
  document.body.classList.remove('admin-mode');
  
  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const adminLogoutBtn = document.getElementById('adminLogoutBtn');
  
  if (adminLoginBtn) adminLoginBtn.classList.add('hidden');
  if (adminLogoutBtn) adminLogoutBtn.classList.add('hidden');
  
  showMessage('Successfully logged out');
  console.log('Admin mode deactivated');
}

function showMessage(text, type = 'success') {
  const message = document.getElementById('message');
  const messageText = document.getElementById('messageText');
  
  if (messageText) messageText.textContent = text;
  
  if (message) {
    message.className = 'message';
    if (type === 'error') {
      message.classList.add('error');
    }
    message.classList.remove('hidden');
    
    setTimeout(function() {
      message.classList.add('hidden');
    }, 3000);
  }
  
  console.log('Message shown:', text, 'Type:', type);
}

// Dashboard functions
function renderDashboard() {
  updateDashboardMetrics();
}

function updateDashboardMetrics() {
  // Calculate metrics
  const totalMembers = appData.members.length;
  const totalActivities = appData.activities.length;
  const totalDonations = appData.donations.reduce(function(sum, d) { return sum + d.amount; }, 0);
  const totalExpenses = appData.expenses.reduce(function(sum, e) { return sum + e.amount; }, 0);
  const netBalance = totalDonations - totalExpenses;
  
  // Calculate fee metrics
  let feesCollected = 0;
  let pendingFees = 0;
  let overdueFees = 0;
  
  appData.weeklyFees.forEach(function(member) {
    member.payments.forEach(function(payment) {
      if (payment.status === 'paid') {
        feesCollected += payment.amount;
      } else if (payment.status === 'pending') {
        pendingFees += payment.amount;
      } else if (payment.status === 'overdue') {
        overdueFees += payment.amount;
      }
    });
  });

  // Update DOM elements with safe access
  const elements = {
    totalMembersCount: document.getElementById('totalMembersCount'),
    totalActivitiesCount: document.getElementById('totalActivitiesCount'),
    totalDonationsAmount: document.getElementById('totalDonationsAmount'),
    totalExpensesAmount: document.getElementById('totalExpensesAmount'),
    netBalanceAmount: document.getElementById('netBalanceAmount'),
    feesCollectedAmount: document.getElementById('feesCollectedAmount')
  };

  if (elements.totalMembersCount) elements.totalMembersCount.textContent = totalMembers;
  if (elements.totalActivitiesCount) elements.totalActivitiesCount.textContent = totalActivities;
  if (elements.totalDonationsAmount) elements.totalDonationsAmount.textContent = '₹' + totalDonations.toLocaleString();
  if (elements.totalExpensesAmount) elements.totalExpensesAmount.textContent = '₹' + totalExpenses.toLocaleString();
  if (elements.netBalanceAmount) elements.netBalanceAmount.textContent = '₹' + netBalance.toLocaleString();
  if (elements.feesCollectedAmount) elements.feesCollectedAmount.textContent = '₹' + feesCollected.toLocaleString();
}

function renderCharts() {
  renderFinancialChart();
  renderExpenseChart();
}

function renderFinancialChart() {
  const ctx = document.getElementById('financialChart');
  if (!ctx) return;

  if (financialChart) {
    financialChart.destroy();
  }

  const totalDonations = appData.donations.reduce(function(sum, d) { return sum + d.amount; }, 0);
  const totalExpenses = appData.expenses.reduce(function(sum, e) { return sum + e.amount; }, 0);
  const netBalance = totalDonations - totalExpenses;

  financialChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Donations', 'Expenses', 'Net Balance'],
      datasets: [{
        label: 'Amount (₹)',
        data: [totalDonations, totalExpenses, netBalance],
        backgroundColor: ['#1FB8CD', '#B4413C', '#FFC185'],
        borderColor: ['#1FB8CD', '#B4413C', '#FFC185'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return '₹' + value.toLocaleString();
            }
          }
        }
      }
    }
  });
}

function renderExpenseChart() {
  const ctx = document.getElementById('expenseChart');
  if (!ctx) return;

  if (expenseChart) {
    expenseChart.destroy();
  }

  // Group expenses by category
  const expensesByCategory = {};
  appData.expenses.forEach(function(expense) {
    if (expensesByCategory[expense.category]) {
      expensesByCategory[expense.category] += expense.amount;
    } else {
      expensesByCategory[expense.category] = expense.amount;
    }
  });

  const labels = Object.keys(expensesByCategory);
  const data = Object.values(expensesByCategory);
  const colors = ['#1FB8CD', '#FFC185', '#B4413C', '#ECEBD5', '#5D878F', '#DB4545', '#D2BA4C', '#964325', '#944454', '#13343B'];

  expenseChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: labels,
      datasets: [{
        data: data,
        backgroundColor: colors.slice(0, labels.length),
        borderWidth: 2,
        borderColor: '#ffffff'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom'
        }
      }
    }
  });
}

function renderRecentActivities() {
  const container = document.getElementById('recentActivitiesSummary');
  if (!container) return;

  container.innerHTML = '';

  // Get next 3 upcoming activities
  const upcomingActivities = appData.activities
    .filter(function(activity) { return new Date(activity.date) >= new Date(); })
    .sort(function(a, b) { return new Date(a.date) - new Date(b.date); })
    .slice(0, 3);

  upcomingActivities.forEach(function(activity) {
    const card = document.createElement('div');
    card.className = 'summary-activity-card';
    
    const formattedDate = new Date(activity.date).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });

    card.innerHTML = '<h4>' + activity.title + '</h4>' +
      '<div class="activity-date">📅 ' + formattedDate + ' at ' + activity.time + '</div>';

    container.appendChild(card);
  });
}

// Render functions
function renderActivities() {
  const grid = document.getElementById('activitiesGrid');
  if (!grid) return;
  
  grid.innerHTML = '';

  appData.activities.forEach(function(activity) {
    const activityCard = createActivityCard(activity);
    grid.appendChild(activityCard);
  });
}

function createActivityCard(activity) {
  const card = document.createElement('div');
  card.className = 'activity-card';
  
  const formattedDate = new Date(activity.date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  card.innerHTML = 
    '<img src="' + activity.image + '" alt="' + activity.title + '" class="activity-image" onerror="this.style.display=\'none\'">' +
    '<h4 class="activity-title">' + activity.title + '</h4>' +
    '<div class="activity-meta">' +
      '<span>📅 ' + formattedDate + '</span>' +
      '<span>🕐 ' + activity.time + '</span>' +
    '</div>' +
    '<p class="activity-description">' + activity.description + '</p>' +
    '<div class="card-actions">' +
      '<button class="btn btn--sm btn--outline" onclick="editActivity(' + activity.id + ')">Edit</button>' +
      '<button class="btn btn--sm btn--outline" onclick="deleteActivity(' + activity.id + ')" style="color: var(--club-red); border-color: var(--club-red);">Delete</button>' +
    '</div>';

  return card;
}

function renderMembers() {
  const grid = document.getElementById('membersGrid');
  if (!grid) return;

  grid.innerHTML = '';

  appData.members.forEach(function(member) {
    const memberCard = createMemberCard(member);
    grid.appendChild(memberCard);
  });
}

function createMemberCard(member) {
  const card = document.createElement('div');
  card.className = 'member-card';
  card.setAttribute('data-member-name', member.name.toLowerCase());
  card.setAttribute('data-member-role', member.role.toLowerCase());
  
  const formattedDate = new Date(member.joinDate).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  card.innerHTML = 
    '<img src="' + member.image + '" alt="' + member.name + '" class="member-image" onerror="this.style.display=\'none\'">' +
    '<h4 class="member-name">' + member.name + '</h4>' +
    '<div class="member-role">' + member.role + '</div>' +
    '<div class="member-info">' +
      '<div>📧 ' + member.contact + '</div>' +
      '<div>📞 ' + member.phone + '</div>' +
      '<div>📅 Joined: ' + formattedDate + '</div>' +
    '</div>' +
    '<div class="card-actions">' +
      '<button class="btn btn--sm btn--outline" onclick="editMember(' + member.id + ')">Edit</button>' +
      '<button class="btn btn--sm btn--outline" onclick="deleteMember(' + member.id + ')" style="color: var(--club-red); border-color: var(--club-red);">Delete</button>' +
    '</div>';

  return card;
}

function renderDonations() {
  const grid = document.getElementById('donationsGrid');
  if (!grid) return;

  grid.innerHTML = '';

  appData.donations.forEach(function(donation) {
    const donationCard = createDonationCard(donation);
    grid.appendChild(donationCard);
  });
}

function createDonationCard(donation) {
  const card = document.createElement('div');
  card.className = 'donation-card';
  
  const formattedDate = new Date(donation.date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  card.innerHTML = 
    '<div class="donation-header">' +
      '<div class="donor-name">' + donation.donorName + '</div>' +
      '<div class="donation-amount">₹' + donation.amount.toLocaleString() + '</div>' +
    '</div>' +
    '<div class="donation-meta">' +
      '<span>📅 ' + formattedDate + '</span>' +
    '</div>' +
    '<div class="donation-purpose">' + donation.purpose + '</div>' +
    '<div class="card-actions">' +
      '<button class="btn btn--sm btn--outline" onclick="editDonation(' + donation.id + ')">Edit</button>' +
      '<button class="btn btn--sm btn--outline" onclick="deleteDonation(' + donation.id + ')" style="color: var(--club-red); border-color: var(--club-red);">Delete</button>' +
    '</div>';

  return card;
}

function renderExpenses() {
  const grid = document.getElementById('expensesGrid');
  if (!grid) return;

  grid.innerHTML = '';

  appData.expenses.forEach(function(expense) {
    const expenseCard = createExpenseCard(expense);
    grid.appendChild(expenseCard);
  });
}

function createExpenseCard(expense) {
  const card = document.createElement('div');
  card.className = 'expense-card';
  
  const formattedDate = new Date(expense.date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  card.innerHTML = 
    '<div class="expense-header">' +
      '<div class="expense-description">' + expense.description + '</div>' +
      '<div class="expense-amount">₹' + expense.amount.toLocaleString() + '</div>' +
    '</div>' +
    '<div class="expense-meta">' +
      '<span>📅 ' + formattedDate + '</span>' +
      '<span>🏪 ' + expense.vendor + '</span>' +
      '<span>💳 ' + expense.paymentMethod + '</span>' +
      '<span class="expense-category">' + expense.category + '</span>' +
    '</div>' +
    '<div class="card-actions">' +
      '<button class="btn btn--sm btn--outline" onclick="editExpense(' + expense.id + ')">Edit</button>' +
      '<button class="btn btn--sm btn--outline" onclick="deleteExpense(' + expense.id + ')" style="color: var(--club-red); border-color: var(--club-red);">Delete</button>' +
    '</div>';

  return card;
}

function renderExperiences() {
  const timeline = document.getElementById('experiencesTimeline');
  if (!timeline) return;

  timeline.innerHTML = '';

  // Sort experiences by date (newest first)
  const sortedExperiences = appData.experiences.slice().sort(function(a, b) {
    return new Date(b.date) - new Date(a.date);
  });

  sortedExperiences.forEach(function(experience) {
    const experienceCard = createExperienceCard(experience);
    timeline.appendChild(experienceCard);
  });
}

function createExperienceCard(experience) {
  const card = document.createElement('div');
  card.className = 'experience-card';
  
  const formattedDate = new Date(experience.date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  card.innerHTML = 
    '<img src="' + experience.image + '" alt="' + experience.title + '" class="experience-image" onerror="this.style.display=\'none\'">' +
    '<div class="experience-content">' +
      '<h4 class="experience-title">' + experience.title + '</h4>' +
      '<div class="experience-date">📅 ' + formattedDate + '</div>' +
      '<p class="experience-description">' + experience.description + '</p>' +
      '<div class="card-actions">' +
        '<button class="btn btn--sm btn--outline" onclick="editExperience(' + experience.id + ')">Edit</button>' +
        '<button class="btn btn--sm btn--outline" onclick="deleteExperience(' + experience.id + ')" style="color: var(--club-red); border-color: var(--club-red);">Delete</button>' +
      '</div>' +
    '</div>';

  return card;
}

function renderWeeklyFees() {
  const grid = document.getElementById('weeklyFeesGrid');
  if (!grid) return;

  grid.innerHTML = '';

  appData.weeklyFees.forEach(function(feeRecord) {
    const feeCard = createFeeCard(feeRecord);
    grid.appendChild(feeCard);
  });
}

function createFeeCard(feeRecord) {
  const card = document.createElement('div');
  card.className = 'fee-card';
  
  const paidCount = feeRecord.payments.filter(function(p) { return p.status === 'paid'; }).length;
  const totalCount = feeRecord.payments.length;
  const paidAmount = paidCount * 20;

  const paymentsHTML = feeRecord.payments.map(function(payment) {
    const dateStr = new Date(payment.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    const cursor = isAdminMode ? 'pointer' : 'default';
    return '<div class="payment-item ' + payment.status + '">' +
      '<span>' + dateStr + '</span>' +
      '<span class="status-badge ' + payment.status + '" onclick="togglePaymentStatus(' + feeRecord.memberId + ', \'' + payment.date + '\')" style="cursor: ' + cursor + ';">' +
        payment.status +
      '</span>' +
    '</div>';
  }).join('');

  card.innerHTML = 
    '<div class="fee-header">' +
      '<div class="member-name">' + feeRecord.memberName + '</div>' +
      '<div class="payment-summary">' + paidCount + '/' + totalCount + ' payments (₹' + paidAmount + ')</div>' +
    '</div>' +
    '<div class="payment-history">' +
      paymentsHTML +
    '</div>';

  return card;
}

function updateTotalDonations() {
  const total = appData.donations.reduce(function(sum, donation) { return sum + donation.amount; }, 0);
  const totalElement = document.getElementById('totalDonations');
  if (totalElement) {
    totalElement.textContent = '₹' + total.toLocaleString();
  }
}

function updateTotalExpenses() {
  const total = appData.expenses.reduce(function(sum, expense) { return sum + expense.amount; }, 0);
  const totalElement = document.getElementById('totalExpenses');
  if (totalElement) {
    totalElement.textContent = '₹' + total.toLocaleString();
  }
}

function filterMembers(searchTerm) {
  const cards = document.querySelectorAll('.member-card');
  const normalizedSearch = searchTerm.toLowerCase().trim();
  
  cards.forEach(function(card) {
    if (normalizedSearch === '') {
      card.style.display = 'block';
    } else {
      const name = card.getAttribute('data-member-name') || '';
      const role = card.getAttribute('data-member-role') || '';
      const isMatch = name.includes(normalizedSearch) || role.includes(normalizedSearch);
      card.style.display = isMatch ? 'block' : 'none';
    }
  });
}

// CRUD operations
function saveActivity() {
  const title = document.getElementById('activityTitle').value;
  const date = document.getElementById('activityDate').value;
  const time = document.getElementById('activityTime').value;
  const description = document.getElementById('activityDescription').value;
  const image = document.getElementById('activityImage').value || 'https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=400&h=300&fit=crop';
  const status = document.getElementById('activityStatus').value;

  if (currentEditingItem) {
    const index = appData.activities.findIndex(function(a) { return a.id === currentEditingItem; });
    if (index !== -1) {
      appData.activities[index] = Object.assign({}, appData.activities[index], { title: title, date: date, time: time, description: description, image: image, status: status });
    }
  } else {
    const newId = Math.max.apply(Math, appData.activities.map(function(a) { return a.id; }).concat([0])) + 1;
    appData.activities.push({ id: newId, title: title, date: date, time: time, description: description, image: image, status: status });
  }

  renderActivities();
  renderHomeEvents();
  renderRecentActivities();
  updateDashboardMetrics();
  showMessage(currentEditingItem ? 'Activity updated successfully' : 'Activity added successfully');
}

function editActivity(id) {
  const activity = appData.activities.find(function(a) { return a.id === id; });
  if (!activity) return;

  currentEditingItem = id;
  currentEditingType = 'activity';
  
  const elements = {
    modalTitle: document.getElementById('activityModalTitle'),
    title: document.getElementById('activityTitle'),
    date: document.getElementById('activityDate'),
    time: document.getElementById('activityTime'),
    description: document.getElementById('activityDescription'),
    image: document.getElementById('activityImage'),
    status: document.getElementById('activityStatus'),
    modal: document.getElementById('activityModal')
  };

  if (elements.modalTitle) elements.modalTitle.textContent = 'Edit Activity';
  if (elements.title) elements.title.value = activity.title;
  if (elements.date) elements.date.value = activity.date;
  if (elements.time) elements.time.value = activity.time;
  if (elements.description) elements.description.value = activity.description;
  if (elements.image) elements.image.value = activity.image;
  if (elements.status) elements.status.value = activity.status || 'upcoming';
  if (elements.modal) elements.modal.classList.remove('hidden');
}

function deleteActivity(id) {
  if (confirm('Are you sure you want to delete this activity?')) {
    appData.activities = appData.activities.filter(function(a) { return a.id !== id; });
    renderActivities();
    renderHomeEvents();
    renderRecentActivities();
    updateDashboardMetrics();
    showMessage('Activity deleted successfully');
  }
}

function saveMember() {
  const name = document.getElementById('memberName').value;
  const contact = document.getElementById('memberContact').value;
  const phone = document.getElementById('memberPhone').value;
  const role = document.getElementById('memberRole').value;
  const joinDate = document.getElementById('memberJoinDate').value;
  const image = document.getElementById('memberImage').value || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face';

  if (currentEditingItem) {
    const index = appData.members.findIndex(function(m) { return m.id === currentEditingItem; });
    if (index !== -1) {
      appData.members[index] = Object.assign({}, appData.members[index], { name: name, contact: contact, phone: phone, role: role, joinDate: joinDate, image: image });
    }
    
    // Update weekly fees member name
    const feeIndex = appData.weeklyFees.findIndex(function(f) { return f.memberId === currentEditingItem; });
    if (feeIndex !== -1) {
      appData.weeklyFees[feeIndex].memberName = name;
    }
  } else {
    const newId = Math.max.apply(Math, appData.members.map(function(m) { return m.id; }).concat([0])) + 1;
    appData.members.push({ id: newId, name: name, contact: contact, phone: phone, role: role, joinDate: joinDate, image: image });
    
    // Add weekly fee record for new member
    appData.weeklyFees.push({
      memberId: newId,
      memberName: name,
      payments: [
        { date: "2025-08-03", amount: 20, status: "pending" }
      ]
    });
  }

  renderMembers();
  renderWeeklyFees();
  updateDashboardMetrics();
  showMessage(currentEditingItem ? 'Member updated successfully' : 'Member added successfully');
}

function editMember(id) {
  const member = appData.members.find(function(m) { return m.id === id; });
  if (!member) return;

  currentEditingItem = id;
  currentEditingType = 'member';
  
  const elements = {
    modalTitle: document.getElementById('memberModalTitle'),
    name: document.getElementById('memberName'),
    contact: document.getElementById('memberContact'),
    phone: document.getElementById('memberPhone'),
    role: document.getElementById('memberRole'),
    joinDate: document.getElementById('memberJoinDate'),
    image: document.getElementById('memberImage'),
    modal: document.getElementById('memberModal')
  };

  if (elements.modalTitle) elements.modalTitle.textContent = 'Edit Member';
  if (elements.name) elements.name.value = member.name;
  if (elements.contact) elements.contact.value = member.contact;
  if (elements.phone) elements.phone.value = member.phone;
  if (elements.role) elements.role.value = member.role;
  if (elements.joinDate) elements.joinDate.value = member.joinDate;
  if (elements.image) elements.image.value = member.image;
  if (elements.modal) elements.modal.classList.remove('hidden');
}

function deleteMember(id) {
  if (confirm('Are you sure you want to delete this member?')) {
    appData.members = appData.members.filter(function(m) { return m.id !== id; });
    appData.weeklyFees = appData.weeklyFees.filter(function(f) { return f.memberId !== id; });
    renderMembers();
    renderWeeklyFees();
    updateDashboardMetrics();
    showMessage('Member deleted successfully');
  }
}

function saveDonation() {
  const donorName = document.getElementById('donorName').value;
  const amount = parseInt(document.getElementById('donationAmount').value);
  const date = document.getElementById('donationDate').value;
  const purpose = document.getElementById('donationPurpose').value;

  if (currentEditingItem) {
    const index = appData.donations.findIndex(function(d) { return d.id === currentEditingItem; });
    if (index !== -1) {
      appData.donations[index] = Object.assign({}, appData.donations[index], { donorName: donorName, amount: amount, date: date, purpose: purpose });
    }
  } else {
    const newId = Math.max.apply(Math, appData.donations.map(function(d) { return d.id; }).concat([0])) + 1;
    appData.donations.push({ id: newId, donorName: donorName, amount: amount, date: date, purpose: purpose });
  }

  renderDonations();
  updateTotalDonations();
  updateDashboardMetrics();
  renderCharts();
  showMessage(currentEditingItem ? 'Donation updated successfully' : 'Donation added successfully');
}

function editDonation(id) {
  const donation = appData.donations.find(function(d) { return d.id === id; });
  if (!donation) return;

  currentEditingItem = id;
  currentEditingType = 'donation';
  
  const elements = {
    modalTitle: document.getElementById('donationModalTitle'),
    donorName: document.getElementById('donorName'),
    amount: document.getElementById('donationAmount'),
    date: document.getElementById('donationDate'),
    purpose: document.getElementById('donationPurpose'),
    modal: document.getElementById('donationModal')
  };

  if (elements.modalTitle) elements.modalTitle.textContent = 'Edit Donation';
  if (elements.donorName) elements.donorName.value = donation.donorName;
  if (elements.amount) elements.amount.value = donation.amount;
  if (elements.date) elements.date.value = donation.date;
  if (elements.purpose) elements.purpose.value = donation.purpose;
  if (elements.modal) elements.modal.classList.remove('hidden');
}

function deleteDonation(id) {
  if (confirm('Are you sure you want to delete this donation record?')) {
    appData.donations = appData.donations.filter(function(d) { return d.id !== id; });
    renderDonations();
    updateTotalDonations();
    updateDashboardMetrics();
    renderCharts();
    showMessage('Donation deleted successfully');
  }
}

function saveExpense() {
  const description = document.getElementById('expenseDescription').value;
  const amount = parseInt(document.getElementById('expenseAmount').value);
  const date = document.getElementById('expenseDate').value;
  const category = document.getElementById('expenseCategory').value;
  const vendor = document.getElementById('expenseVendor').value;
  const paymentMethod = document.getElementById('expensePaymentMethod').value;

  if (currentEditingItem) {
    const index = appData.expenses.findIndex(function(e) { return e.id === currentEditingItem; });
    if (index !== -1) {
      appData.expenses[index] = Object.assign({}, appData.expenses[index], { description: description, amount: amount, date: date, category: category, vendor: vendor, paymentMethod: paymentMethod });
    }
  } else {
    const newId = Math.max.apply(Math, appData.expenses.map(function(e) { return e.id; }).concat([0])) + 1;
    appData.expenses.push({ id: newId, description: description, amount: amount, date: date, category: category, vendor: vendor, paymentMethod: paymentMethod });
  }

  renderExpenses();
  updateTotalExpenses();
  updateDashboardMetrics();
  renderCharts();
  showMessage(currentEditingItem ? 'Expense updated successfully' : 'Expense added successfully');
}

function editExpense(id) {
  const expense = appData.expenses.find(function(e) { return e.id === id; });
  if (!expense) return;

  currentEditingItem = id;
  currentEditingType = 'expense';
  
  const elements = {
    modalTitle: document.getElementById('expenseModalTitle'),
    description: document.getElementById('expenseDescription'),
    amount: document.getElementById('expenseAmount'),
    date: document.getElementById('expenseDate'),
    category: document.getElementById('expenseCategory'),
    vendor: document.getElementById('expenseVendor'),
    paymentMethod: document.getElementById('expensePaymentMethod'),
    modal: document.getElementById('expenseModal')
  };

  if (elements.modalTitle) elements.modalTitle.textContent = 'Edit Expense';
  if (elements.description) elements.description.value = expense.description;
  if (elements.amount) elements.amount.value = expense.amount;
  if (elements.date) elements.date.value = expense.date;
  if (elements.category) elements.category.value = expense.category;
  if (elements.vendor) elements.vendor.value = expense.vendor;
  if (elements.paymentMethod) elements.paymentMethod.value = expense.paymentMethod;
  if (elements.modal) elements.modal.classList.remove('hidden');
}

function deleteExpense(id) {
  if (confirm('Are you sure you want to delete this expense record?')) {
    appData.expenses = appData.expenses.filter(function(e) { return e.id !== id; });
    renderExpenses();
    updateTotalExpenses();
    updateDashboardMetrics();
    renderCharts();
    showMessage('Expense deleted successfully');
  }
}

function saveExperience() {
  const title = document.getElementById('experienceTitle').value;
  const date = document.getElementById('experienceDate').value;
  const description = document.getElementById('experienceDescription').value;
  const image = document.getElementById('experienceImage').value || 'https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?w=400&h=300&fit=crop';

  if (currentEditingItem) {
    const index = appData.experiences.findIndex(function(e) { return e.id === currentEditingItem; });
    if (index !== -1) {
      appData.experiences[index] = Object.assign({}, appData.experiences[index], { title: title, date: date, description: description, image: image });
    }
  } else {
    const newId = Math.max.apply(Math, appData.experiences.map(function(e) { return e.id; }).concat([0])) + 1;
    appData.experiences.push({ id: newId, title: title, date: date, description: description, image: image });
  }

  renderExperiences();
  showMessage(currentEditingItem ? 'Experience updated successfully' : 'Experience added successfully');
}

function editExperience(id) {
  const experience = appData.experiences.find(function(e) { return e.id === id; });
  if (!experience) return;

  currentEditingItem = id;
  currentEditingType = 'experience';
  
  const elements = {
    modalTitle: document.getElementById('experienceModalTitle'),
    title: document.getElementById('experienceTitle'),
    date: document.getElementById('experienceDate'),
    description: document.getElementById('experienceDescription'),
    image: document.getElementById('experienceImage'),
    modal: document.getElementById('experienceModal')
  };

  if (elements.modalTitle) elements.modalTitle.textContent = 'Edit Experience';
  if (elements.title) elements.title.value = experience.title;
  if (elements.date) elements.date.value = experience.date;
  if (elements.description) elements.description.value = experience.description;
  if (elements.image) elements.image.value = experience.image;
  if (elements.modal) elements.modal.classList.remove('hidden');
}

function deleteExperience(id) {
  if (confirm('Are you sure you want to delete this experience?')) {
    appData.experiences = appData.experiences.filter(function(e) { return e.id !== id; });
    renderExperiences();
    showMessage('Experience deleted successfully');
  }
}

function togglePaymentStatus(memberId, paymentDate) {
  if (!isAdminMode) return;
  
  const feeRecord = appData.weeklyFees.find(function(f) { return f.memberId === memberId; });
  if (!feeRecord) return;
  
  const payment = feeRecord.payments.find(function(p) { return p.date === paymentDate; });
  if (!payment) return;
  
  // Cycle through statuses: pending -> paid -> overdue -> pending
  if (payment.status === 'pending') {
    payment.status = 'paid';
  } else if (payment.status === 'paid') {
    payment.status = 'overdue';
  } else {
    payment.status = 'pending';
  }
  
  renderWeeklyFees();
  updateDashboardMetrics();
  showMessage('Payment status updated to ' + payment.status);
}

// PDF Export Functions
function exportToPDF(type) {
  if (!window.html2pdf) {
    showMessage('PDF export library not loaded. Please refresh the page.', 'error');
    return;
  }

  showMessage('Generating PDF report...', 'info');
  
  const opt = {
    margin: 1,
    filename: 'ledo-sports-academy-' + type + '-report.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
  };

  let content = '';

  switch (type) {
    case 'all':
      content = generateCompleteReport();
      break;
    case 'financial':
      content = generateFinancialReport();
      break;
    case 'members':
      content = generateMembersReport();
      break;
    case 'expenses':
      content = generateExpensesReport();
      break;
  }

  const element = document.createElement('div');
  element.innerHTML = content;
  element.style.padding = '20px';
  element.style.fontFamily = 'Arial, sans-serif';

  html2pdf().set(opt).from(element).save().then(function() {
    showMessage('PDF report generated successfully!');
  }).catch(function() {
    showMessage('Error generating PDF report', 'error');
  });
}

function generateCompleteReport() {
  const totalDonations = appData.donations.reduce(function(sum, d) { return sum + d.amount; }, 0);
  const totalExpenses = appData.expenses.reduce(function(sum, e) { return sum + e.amount; }, 0);
  const netBalance = totalDonations - totalExpenses;

  return '<div style="text-align: center; margin-bottom: 30px;">' +
      '<h1 style="color: #1e3a8a; margin-bottom: 10px;">Ledo Sports Academy</h1>' +
      '<h2 style="color: #6b7280; margin-bottom: 5px;">Complete Academy Report</h2>' +
      '<p style="color: #6b7280;">Generated on ' + new Date().toLocaleDateString() + '</p>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Academy Overview</h3>' +
      '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">' +
        '<div style="text-align: center; padding: 15px; background: #f3f4f6; border-radius: 8px;">' +
          '<h4>Total Members</h4>' +
          '<p style="font-size: 24px; font-weight: bold; color: #1e3a8a;">' + appData.members.length + '</p>' +
        '</div>' +
        '<div style="text-align: center; padding: 15px; background: #f3f4f6; border-radius: 8px;">' +
          '<h4>Total Activities</h4>' +
          '<p style="font-size: 24px; font-weight: bold; color: #1e3a8a;">' + appData.activities.length + '</p>' +
        '</div>' +
        '<div style="text-align: center; padding: 15px; background: #f3f4f6; border-radius: 8px;">' +
          '<h4>Net Balance</h4>' +
          '<p style="font-size: 24px; font-weight: bold; color: ' + (netBalance >= 0 ? '#10b981' : '#ef4444') + ';">₹' + netBalance.toLocaleString() + '</p>' +
        '</div>' +
      '</div>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Members</h3>' +
      '<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">' +
        '<thead>' +
          '<tr style="background: #1e3a8a; color: white;">' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Name</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Role</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Join Date</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Contact</th>' +
          '</tr>' +
        '</thead>' +
        '<tbody>' +
          appData.members.map(function(member) {
            return '<tr>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + member.name + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + member.role + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + new Date(member.joinDate).toLocaleDateString() + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + member.contact + '</td>' +
            '</tr>';
          }).join('') +
        '</tbody>' +
      '</table>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Financial Summary</h3>' +
      '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">' +
        '<div>' +
          '<h4>Donations: ₹' + totalDonations.toLocaleString() + '</h4>' +
          '<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">' +
            '<thead>' +
              '<tr style="background: #10b981; color: white;">' +
                '<th style="padding: 8px; text-align: left; border: 1px solid #ccc;">Donor</th>' +
                '<th style="padding: 8px; text-align: left; border: 1px solid #ccc;">Amount</th>' +
                '<th style="padding: 8px; text-align: left; border: 1px solid #ccc;">Date</th>' +
              '</tr>' +
            '</thead>' +
            '<tbody>' +
              appData.donations.map(function(donation) {
                return '<tr>' +
                  '<td style="padding: 6px; border: 1px solid #ccc;">' + donation.donorName + '</td>' +
                  '<td style="padding: 6px; border: 1px solid #ccc;">₹' + donation.amount.toLocaleString() + '</td>' +
                  '<td style="padding: 6px; border: 1px solid #ccc;">' + new Date(donation.date).toLocaleDateString() + '</td>' +
                '</tr>';
              }).join('') +
            '</tbody>' +
          '</table>' +
        '</div>' +
        '<div>' +
          '<h4>Expenses: ₹' + totalExpenses.toLocaleString() + '</h4>' +
          '<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">' +
            '<thead>' +
              '<tr style="background: #ef4444; color: white;">' +
                '<th style="padding: 8px; text-align: left; border: 1px solid #ccc;">Description</th>' +
                '<th style="padding: 8px; text-align: left; border: 1px solid #ccc;">Amount</th>' +
                '<th style="padding: 8px; text-align: left; border: 1px solid #ccc;">Category</th>' +
              '</tr>' +
            '</thead>' +
            '<tbody>' +
              appData.expenses.map(function(expense) {
                return '<tr>' +
                  '<td style="padding: 6px; border: 1px solid #ccc;">' + expense.description + '</td>' +
                  '<td style="padding: 6px; border: 1px solid #ccc;">₹' + expense.amount.toLocaleString() + '</td>' +
                  '<td style="padding: 6px; border: 1px solid #ccc;">' + expense.category + '</td>' +
                '</tr>';
              }).join('') +
            '</tbody>' +
          '</table>' +
        '</div>' +
      '</div>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Upcoming Activities</h3>' +
      appData.activities.map(function(activity) {
        return '<div style="margin: 15px 0; padding: 15px; background: #f3f4f6; border-radius: 8px;">' +
          '<h4 style="color: #1e3a8a; margin-bottom: 5px;">' + activity.title + '</h4>' +
          '<p style="margin: 5px 0;"><strong>Date:</strong> ' + new Date(activity.date).toLocaleDateString() + ' at ' + activity.time + '</p>' +
          '<p style="margin: 5px 0;">' + activity.description + '</p>' +
        '</div>';
      }).join('') +
    '</div>';
}

function generateFinancialReport() {
  const totalDonations = appData.donations.reduce(function(sum, d) { return sum + d.amount; }, 0);
  const totalExpenses = appData.expenses.reduce(function(sum, e) { return sum + e.amount; }, 0);
  const netBalance = totalDonations - totalExpenses;

  return '<div style="text-align: center; margin-bottom: 30px;">' +
      '<h1 style="color: #1e3a8a; margin-bottom: 10px;">Ledo Sports Academy</h1>' +
      '<h2 style="color: #6b7280; margin-bottom: 5px;">Financial Report</h2>' +
      '<p style="color: #6b7280;">Generated on ' + new Date().toLocaleDateString() + '</p>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Financial Summary</h3>' +
      '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">' +
        '<div style="text-align: center; padding: 15px; background: #f3f4f6; border-radius: 8px;">' +
          '<h4>Total Donations</h4>' +
          '<p style="font-size: 24px; font-weight: bold; color: #10b981;">₹' + totalDonations.toLocaleString() + '</p>' +
        '</div>' +
        '<div style="text-align: center; padding: 15px; background: #f3f4f6; border-radius: 8px;">' +
          '<h4>Total Expenses</h4>' +
          '<p style="font-size: 24px; font-weight: bold; color: #ef4444;">₹' + totalExpenses.toLocaleString() + '</p>' +
        '</div>' +
        '<div style="text-align: center; padding: 15px; background: #f3f4f6; border-radius: 8px;">' +
          '<h4>Net Balance</h4>' +
          '<p style="font-size: 24px; font-weight: bold; color: ' + (netBalance >= 0 ? '#10b981' : '#ef4444') + ';">₹' + netBalance.toLocaleString() + '</p>' +
        '</div>' +
      '</div>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Donations</h3>' +
      '<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">' +
        '<thead>' +
          '<tr style="background: #10b981; color: white;">' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Donor Name</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Amount</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Date</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Purpose</th>' +
          '</tr>' +
        '</thead>' +
        '<tbody>' +
          appData.donations.map(function(donation) {
            return '<tr>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + donation.donorName + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">₹' + donation.amount.toLocaleString() + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + new Date(donation.date).toLocaleDateString() + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + donation.purpose + '</td>' +
            '</tr>';
          }).join('') +
        '</tbody>' +
      '</table>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Expenses</h3>' +
      '<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">' +
        '<thead>' +
          '<tr style="background: #ef4444; color: white;">' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Description</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Amount</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Date</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Category</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Vendor</th>' +
          '</tr>' +
        '</thead>' +
        '<tbody>' +
          appData.expenses.map(function(expense) {
            return '<tr>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + expense.description + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">₹' + expense.amount.toLocaleString() + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + new Date(expense.date).toLocaleDateString() + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + expense.category + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + expense.vendor + '</td>' +
            '</tr>';
          }).join('') +
        '</tbody>' +
      '</table>' +
    '</div>';
}

function generateMembersReport() {
  return '<div style="text-align: center; margin-bottom: 30px;">' +
      '<h1 style="color: #1e3a8a; margin-bottom: 10px;">Ledo Sports Academy</h1>' +
      '<h2 style="color: #6b7280; margin-bottom: 5px;">Members Report</h2>' +
      '<p style="color: #6b7280;">Generated on ' + new Date().toLocaleDateString() + '</p>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Member Directory</h3>' +
      '<p>Total Members: <strong>' + appData.members.length + '</strong></p>' +
      '<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">' +
        '<thead>' +
          '<tr style="background: #1e3a8a; color: white;">' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Name</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Role</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Join Date</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Email</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Phone</th>' +
          '</tr>' +
        '</thead>' +
        '<tbody>' +
          appData.members.map(function(member) {
            return '<tr>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + member.name + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + member.role + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + new Date(member.joinDate).toLocaleDateString() + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + member.contact + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + member.phone + '</td>' +
            '</tr>';
          }).join('') +
        '</tbody>' +
      '</table>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Fee Status</h3>' +
      appData.weeklyFees.map(function(feeRecord) {
        const paidCount = feeRecord.payments.filter(function(p) { return p.status === 'paid'; }).length;
        const totalCount = feeRecord.payments.length;
        const paidAmount = paidCount * 20;
        return '<div style="margin: 15px 0; padding: 15px; background: #f3f4f6; border-radius: 8px;">' +
          '<h4 style="color: #1e3a8a; margin-bottom: 5px;">' + feeRecord.memberName + '</h4>' +
          '<p><strong>Payments:</strong> ' + paidCount + '/' + totalCount + ' completed</p>' +
          '<p><strong>Amount Paid:</strong> ₹' + paidAmount + '</p>' +
          '<p><strong>Payment History:</strong> ' + feeRecord.payments.map(function(p) { return new Date(p.date).toLocaleDateString() + ' - ' + p.status; }).join(', ') + '</p>' +
        '</div>';
      }).join('') +
    '</div>';
}

function generateExpensesReport() {
  const totalExpenses = appData.expenses.reduce(function(sum, e) { return sum + e.amount; }, 0);
  
  // Group expenses by category
  const expensesByCategory = {};
  appData.expenses.forEach(function(expense) {
    if (expensesByCategory[expense.category]) {
      expensesByCategory[expense.category] += expense.amount;
    } else {
      expensesByCategory[expense.category] = expense.amount;
    }
  });

  return '<div style="text-align: center; margin-bottom: 30px;">' +
      '<h1 style="color: #1e3a8a; margin-bottom: 10px;">Ledo Sports Academy</h1>' +
      '<h2 style="color: #6b7280; margin-bottom: 5px;">Expenses Report</h2>' +
      '<p style="color: #6b7280;">Generated on ' + new Date().toLocaleDateString() + '</p>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Expense Summary</h3>' +
      '<div style="text-align: center; padding: 15px; background: #f3f4f6; border-radius: 8px; margin: 20px 0;">' +
        '<h4>Total Expenses</h4>' +
        '<p style="font-size: 24px; font-weight: bold; color: #ef4444;">₹' + totalExpenses.toLocaleString() + '</p>' +
      '</div>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Expenses by Category</h3>' +
      '<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">' +
        '<thead>' +
          '<tr style="background: #ef4444; color: white;">' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Category</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Total Amount</th>' +
          '</tr>' +
        '</thead>' +
        '<tbody>' +
          Object.keys(expensesByCategory).map(function(category) {
            return '<tr>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + category + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">₹' + expensesByCategory[category].toLocaleString() + '</td>' +
            '</tr>';
          }).join('') +
        '</tbody>' +
      '</table>' +
    '</div>' +

    '<div style="margin-bottom: 30px;">' +
      '<h3 style="color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 5px;">Detailed Expenses</h3>' +
      '<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">' +
        '<thead>' +
          '<tr style="background: #ef4444; color: white;">' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Description</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Amount</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Date</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Category</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Vendor</th>' +
            '<th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Payment Method</th>' +
          '</tr>' +
        '</thead>' +
        '<tbody>' +
          appData.expenses.map(function(expense) {
            return '<tr>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + expense.description + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">₹' + expense.amount.toLocaleString() + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + new Date(expense.date).toLocaleDateString() + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + expense.category + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + expense.vendor + '</td>' +
              '<td style="padding: 8px; border: 1px solid #ccc;">' + expense.paymentMethod + '</td>' +
            '</tr>';
          }).join('') +
        '</tbody>' +
      '</table>' +
    '</div>';
}