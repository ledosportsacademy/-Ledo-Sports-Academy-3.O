<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MongoDB Data Operations Demo</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <style>
    .demo-container {
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .demo-section {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    .demo-section:last-child {
      border-bottom: none;
    }
    .result-box {
      background-color: #f8f9fa;
      border-radius: 4px;
      padding: 15px;
      margin-top: 15px;
      min-height: 100px;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .success {
      color: #28a745;
    }
    .error {
      color: #dc3545;
    }
    .nav-tabs {
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="/">Ledo Sports Academy</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="/mongodb-demo.html">MongoDB Demo</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin">Admin</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container demo-container">
    <h1 class="text-center mb-4">MongoDB Data Operations Demo</h1>
    <p class="text-center mb-4">This page demonstrates how to perform CRUD operations with MongoDB in the Ledo Sports Academy application.</p>
    
    <ul class="nav nav-tabs" id="operationTabs" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="create-tab" data-toggle="tab" href="#create" role="tab">Create</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="read-tab" data-toggle="tab" href="#read" role="tab">Read</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="update-tab" data-toggle="tab" href="#update" role="tab">Update</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="delete-tab" data-toggle="tab" href="#delete" role="tab">Delete</a>
      </li>
    </ul>
    
    <div class="tab-content" id="operationTabsContent">
      <!-- Create Tab -->
      <div class="tab-pane fade show active" id="create" role="tabpanel">
        <div class="demo-section">
          <h3>Create a New Member</h3>
          <form id="createMemberForm">
            <div class="form-group">
              <label for="memberName">Name</label>
              <input type="text" class="form-control" id="memberName" required>
            </div>
            <div class="form-group">
              <label for="memberContact">Email</label>
              <input type="email" class="form-control" id="memberContact" required>
            </div>
            <div class="form-group">
              <label for="memberPhone">Phone</label>
              <input type="text" class="form-control" id="memberPhone" required>
            </div>
            <div class="form-group">
              <label for="memberRole">Role</label>
              <select class="form-control" id="memberRole" required>
                <option value="Player">Player</option>
                <option value="Coach">Coach</option>
                <option value="Staff">Staff</option>
                <option value="Admin">Admin</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">Create Member</button>
          </form>
          <div class="result-box" id="createResult"></div>
        </div>
      </div>
      
      <!-- Read Tab -->
      <div class="tab-pane fade" id="read" role="tabpanel">
        <div class="demo-section">
          <h3>Read Members</h3>
          <div class="form-group">
            <label for="memberFilter">Filter by Role</label>
            <select class="form-control" id="memberFilter">
              <option value="">All Members</option>
              <option value="Player">Players</option>
              <option value="Coach">Coaches</option>
              <option value="Staff">Staff</option>
              <option value="Admin">Admins</option>
            </select>
          </div>
          <button id="readMembersBtn" class="btn btn-primary">Get Members</button>
          <div class="result-box" id="readResult"></div>
        </div>
      </div>
      
      <!-- Update Tab -->
      <div class="tab-pane fade" id="update" role="tabpanel">
        <div class="demo-section">
          <h3>Update a Member</h3>
          <div class="form-group">
            <label for="updateMemberId">Member ID</label>
            <select class="form-control" id="updateMemberId">
              <option value="">Select a member...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="updateMemberRole">New Role</label>
            <select class="form-control" id="updateMemberRole">
              <option value="Player">Player</option>
              <option value="Coach">Coach</option>
              <option value="Staff">Staff</option>
              <option value="Admin">Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label for="updateMemberActive">Active Status</label>
            <select class="form-control" id="updateMemberActive">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>
          <button id="updateMemberBtn" class="btn btn-primary">Update Member</button>
          <div class="result-box" id="updateResult"></div>
        </div>
      </div>
      
      <!-- Delete Tab -->
      <div class="tab-pane fade" id="delete" role="tabpanel">
        <div class="demo-section">
          <h3>Delete a Member</h3>
          <div class="form-group">
            <label for="deleteMemberId">Member ID</label>
            <select class="form-control" id="deleteMemberId">
              <option value="">Select a member...</option>
            </select>
          </div>
          <button id="deleteMemberBtn" class="btn btn-danger">Delete Member</button>
          <div class="result-box" id="deleteResult"></div>
        </div>
      </div>
    </div>
    
    <div class="text-center mt-4">
      <p>For more information on MongoDB operations, see the <a href="/MONGODB.md">MongoDB documentation</a>.</p>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/js/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script>
    // Helper function to display results
    function displayResult(elementId, data, isError = false) {
      const resultElement = document.getElementById(elementId);
      if (isError) {
        resultElement.innerHTML = `<span class="error">Error: ${JSON.stringify(data, null, 2)}</span>`;
      } else {
        resultElement.innerHTML = `<span class="success">${JSON.stringify(data, null, 2)}</span>`;
      }
    }

    // Helper function to populate member dropdowns
    function populateMemberDropdowns() {
      fetch('/api/members')
        .then(response => response.json())
        .then(data => {
          const updateSelect = document.getElementById('updateMemberId');
          const deleteSelect = document.getElementById('deleteMemberId');
          
          // Clear existing options
          updateSelect.innerHTML = '<option value="">Select a member...</option>';
          deleteSelect.innerHTML = '<option value="">Select a member...</option>';
          
          // Add member options
          data.forEach(member => {
            const option = document.createElement('option');
            option.value = member._id;
            option.textContent = `${member.name} (${member.role})`;
            
            updateSelect.appendChild(option.cloneNode(true));
            deleteSelect.appendChild(option);
          });
        })
        .catch(error => {
          console.error('Error fetching members:', error);
        });
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      // Populate member dropdowns on page load
      populateMemberDropdowns();
      
      // Create Member Form
      document.getElementById('createMemberForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const memberData = {
          name: document.getElementById('memberName').value,
          contact: document.getElementById('memberContact').value,
          phone: document.getElementById('memberPhone').value,
          role: document.getElementById('memberRole').value,
          joinDate: new Date(),
          active: true
        };
        
        fetch('/api/members', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(memberData)
        })
        .then(response => response.json())
        .then(data => {
          displayResult('createResult', data);
          populateMemberDropdowns(); // Refresh dropdowns
          document.getElementById('createMemberForm').reset();
        })
        .catch(error => {
          displayResult('createResult', error, true);
        });
      });
      
      // Read Members Button
      document.getElementById('readMembersBtn').addEventListener('click', function() {
        const filter = document.getElementById('memberFilter').value;
        let url = '/api/members';
        
        if (filter) {
          url += `?role=${filter}`;
        }
        
        fetch(url)
          .then(response => response.json())
          .then(data => {
            displayResult('readResult', data);
          })
          .catch(error => {
            displayResult('readResult', error, true);
          });
      });
      
      // Update Member Button
      document.getElementById('updateMemberBtn').addEventListener('click', function() {
        const memberId = document.getElementById('updateMemberId').value;
        
        if (!memberId) {
          displayResult('updateResult', { message: 'Please select a member' }, true);
          return;
        }
        
        const updateData = {
          role: document.getElementById('updateMemberRole').value,
          active: document.getElementById('updateMemberActive').value === 'true'
        };
        
        fetch(`/api/members/${memberId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updateData)
        })
        .then(response => response.json())
        .then(data => {
          displayResult('updateResult', data);
          populateMemberDropdowns(); // Refresh dropdowns
        })
        .catch(error => {
          displayResult('updateResult', error, true);
        });
      });
      
      // Delete Member Button
      document.getElementById('deleteMemberBtn').addEventListener('click', function() {
        const memberId = document.getElementById('deleteMemberId').value;
        
        if (!memberId) {
          displayResult('deleteResult', { message: 'Please select a member' }, true);
          return;
        }
        
        if (confirm('Are you sure you want to delete this member? This action cannot be undone.')) {
          fetch(`/api/members/${memberId}`, {
            method: 'DELETE'
          })
          .then(response => response.json())
          .then(data => {
            displayResult('deleteResult', data);
            populateMemberDropdowns(); // Refresh dropdowns
          })
          .catch(error => {
            displayResult('deleteResult', error, true);
          });
        }
      });
      
      // Tab change event to refresh data
      $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        if (e.target.id === 'read-tab') {
          document.getElementById('readMembersBtn').click();
        } else if (e.target.id === 'update-tab' || e.target.id === 'delete-tab') {
          populateMemberDropdowns();
        }
      });
    });
  </script>
</body>
</html>